<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
<style>html,body,#map{height:100%;margin:0;padding:0}</style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script>
/* Inicializa mapa centrado nas coordenadas padr√£o */
var DEFAULT_LAT = -19.920000, DEFAULT_LON = -43.940000;
var map = L.map('map').setView([DEFAULT_LAT, DEFAULT_LON], 16);
L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: '&copy; <a href=\'https://carto.com/\'>CARTO</a> &mdash; Dados: OSM', maxZoom: 19 }).addTo(map);
L.circle([-19.920000,-43.940000], { radius: 2000, color: '#ff5c5c', weight: 2, fill: true, fillOpacity: 0.04 }).addTo(map);
var currentMarker = L.circleMarker([-19.920000,-43.940000], { radius: 8, color: '#0066cc', fill: true, fillColor: '#00aaff', fillOpacity: 0.9 }).addTo(map);
var routeLine = null;
var route = [];
if (route.length > 1) {
    routeLine = L.polyline(route, { color: 'blue', weight: 4, opacity: 0.8 }).addTo(map);
    try { map.fitBounds(routeLine.getBounds(), {padding: [50,50]}); } catch(e){}
}

/* updateData function (used by Python runJavaScript) */
function updateData(lat, lon, route) {
    try {
        if (typeof lat !== 'number' || typeof lon !== 'number') return;
        if (currentMarker) currentMarker.setLatLng([lat, lon]); else currentMarker = L.circleMarker([lat, lon]).addTo(map);
        if (Array.isArray(route) && route.length > 0) {
            if (routeLine) routeLine.setLatLngs(route);
            else routeLine = L.polyline(route, { color: 'blue', weight: 4, opacity: 0.8 }).addTo(map);
            if (route.length > 1) try { map.fitBounds(routeLine.getBounds(), {padding: [50,50]}); } catch(e){}
        } else {
            try { map.panTo([lat, lon]); } catch(e){}
        }
    } catch(err) { console.error('updateData error', err); }
}
</script>
</body>
</html>